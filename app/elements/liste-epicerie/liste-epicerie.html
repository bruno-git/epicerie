<dom-module id="liste-epicerie">
  <style>
    :host {
      display: block;
    }
  </style>

  <template>
  <template is="dom-if" if="{{connectedToFirebase}}">
    <firebase-collection id="fireProject"
                         location="https://epicerieenligne.firebaseio.com/Epicerie"
                         data="{{epicerie}}"
                         order-by-child="Categorie"
                         equal-to="viande"
                         log
                         on-error="_errorHandler"></firebase-collection>

    <template is="dom-repeat" items="[[epicerie]]" as="epicerie_item">
<!--
        <h4>[[epicerie_item.__firebaseKey__]]</h4>
-->
        <h4><span>[[epicerie_item.Name]]</span></h4>
        <div>Prix: <span>[[epicerie_item.Prix]]</span></div>
        <div>Categorie: <span>[[epicerie_item.Categorie]]</span></div>
        <div>Connected: <span>{{connectedToFirebase}}</span></div>

<!--
        <paper-button raised
                      on-click="_showProjectDetails"
                      project-target="[[project.Desc]]">Show Miletones</paper-button>

        <iron-collapse id=[[epicerie_item.__firebaseKey__]] opened>
          <paper-material>Sub List</paper-material>
        </iron-collapse>
-->
    </template>
  </template>

    <paper-fab mini icon="add"
               data-dialog="dialogNewProject"
               on-click="_clickHandler"></paper-fab>
    <paper-dialog id="dialogNewProject" entry-animation="fade-in-animation">
      <h2>New Project</h2>
      <paper-input id="name" label="Name"></paper-input>
      <paper-input id="manager" label="Manager"></paper-input>
      <paper-textarea id="description" label="Description"></paper-textarea>
      <paper-button dialog-confirm on-click="_submitProject">Submit</paper-button>
    </paper-dialog>

  </template>

</dom-module>
<script>
  Polymer({
    is: 'liste-epicerie',
    properties: {
      connectedToFirebase: {
        type: Boolean
      }
    },
//_CLICKHANDLER
    _clickHandler: function(e){
      var button = e.target;
      while (!button.hasAttribute('data-dialog') && button !== document.body) {
        button = button.parentElement;
      }
      if (!button.hasAttribute('data-dialog')) {
        return;
      }
      var dialogId = button.getAttribute('data-dialog');
      var dialog = document.getElementById(dialogId);

      if (dialog){
        dialog.open();
      }
    },
//_ERRORHANDLER
    _errorHandler: function(e) {
      console.log('Error Handler Message');
      console.log('Firebase-collection error: ' + e);
    },
//_SUBMITPROJECT
    _submitProject: function() {
      if (!this.$.name.value) {
        console.log('titre vide!');
        return;
      }
      var newProject = this.$.fireProject.add({
        Name:this.$.name.value,
        Manager:this.$.manager.value,
        Desc: this.$.description.value
      });
      console.log('new project created: ' + newProject);
    },
//_SHOWPROJECTDETAILS
    _showProjectDetails: function(e) {
      var isArray = Array.isArray(e.model.epicerie_item.MilestoneList);

      var collapseId = e.model.epicerie_item.__firebaseKey__;
      document.getElementById(collapseId).toggle();

      var nodeName = e.target.parentElement.nodeName;
      console.log('nodeName: ' + nodeName);

    }

  });
</script>
